<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:RecipeApp.Mobile.ViewModels"
             xmlns:models="clr-namespace:RecipeApp.Models;assembly=RecipeApp.Models"
             xmlns:converters="clr-namespace:RecipeApp.Mobile.Converters"
             x:Class="RecipeApp.Mobile.MainPage"
             x:Name="mainPage"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:ImageFileNameToSourceConverter x:Key="ImageConverter" />
            <converters:LanguageConverter x:Key="LanguageConverter" />
            <converters:LanguageToColorConverter x:Key="LanguageToColorConverter" />
            <converters:LanguageToVisibilityConverter x:Key="LanguageToVisibilityConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Categories Grid -->
        <RefreshView Grid.Row="0" IsRefreshing="{Binding IsBusy}">
            <CollectionView ItemsSource="{Binding Categories}"
                           SelectionMode="Single">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                   Span="2" 
                                   HorizontalItemSpacing="10" 
                                   VerticalItemSpacing="10" />
                </CollectionView.ItemsLayout>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="10">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={x:Reference Name=mainPage}, Path=BindingContext.GoToCategoryCommand}"
                                    CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>

                            <!-- Main Frame for visual styling with compiled bindings -->
                            <Border BackgroundColor="Transparent"
                                   Padding="0"
                                   HeightRequest="150">
                                
                                <Grid>
                                    <!-- Category Background Image -->
                                    <Image Source="{Binding ImageFileName, Converter={StaticResource ImageConverter}}"
                                           Aspect="AspectFill"
                                           VerticalOptions="FillAndExpand"
                                           HorizontalOptions="FillAndExpand" />
                                    
                                    <!-- Category Name -->
                                    <Label Text="{Binding Name, Converter={StaticResource LanguageConverter}}" 
                                           FontSize="25" 
                                           FontAttributes="Bold" 
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           VerticalTextAlignment="Center"
                                           LineBreakMode="WordWrap"
                                           MaxLines="2" />
                                </Grid>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand">
                        <Label Text="No categories found" 
                               FontSize="18" 
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}"
                               HorizontalOptions="Center" />
                        <Label Text="Try refreshing or check your connection" 
                               FontSize="14" 
                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                               HorizontalOptions="Center" />
                    </StackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <!-- Banner Ad Placeholder -->
        <Frame Grid.Row="1" 
               BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray800}}" 
               HeightRequest="50" 
               Margin="0"
               CornerRadius="0"
               HasShadow="False">
            <Label Text="Banner Ad Placeholder" 
                   FontSize="12" 
                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}"
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" />
        </Frame>

    </Grid>
</ContentPage>
