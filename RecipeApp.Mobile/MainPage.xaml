<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:RecipeApp.Mobile.ViewModels"
             xmlns:models="clr-namespace:RecipeApp.Models;assembly=RecipeApp.Models"
             xmlns:converters="clr-namespace:RecipeApp.Mobile.Converters"
             xmlns:strings="clr-namespace:RecipeApp.Mobile.Resources.Strings"
             xmlns:admob="clr-namespace:Plugin.MauiMTAdmob.Controls;assembly=Plugin.MauiMTAdmob"
             x:Class="RecipeApp.Mobile.MainPage"
             x:Name="mainPage"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:ImageFileNameToSourceConverter x:Key="ImageConverter" />
            <converters:LanguageConverter x:Key="LanguageConverter" />
            <converters:StaticResourceConverter x:Key="StaticResourceConverter" />
            <converters:LanguageToColorConverter x:Key="LanguageToColorConverter" />
            <converters:LanguageToVisibilityConverter x:Key="LanguageToVisibilityConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Categories Grid -->
        <RefreshView Grid.Row="0" IsRefreshing="{Binding IsBusy}">
            <CollectionView ItemsSource="{Binding Categories}"
                           SelectionMode="Single">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                   Span="2" 
                                   HorizontalItemSpacing="10" 
                                   VerticalItemSpacing="10" />
                </CollectionView.ItemsLayout>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="12">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={x:Reference Name=mainPage}, Path=BindingContext.GoToCategoryCommand}"
                                    CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>

                            <!-- Modern Card Design with Shadow -->
                            <Border BackgroundColor="Transparent"
                                   Padding="0"
                                   HeightRequest="160"
                                   StrokeShape="RoundRectangle 16"
                                   StrokeThickness="0"
                                   Shadow="0,4,12,#40000000">
                                
                                <Grid>
                                    <!-- Clipped Background Image -->
                                    <Border StrokeShape="RoundRectangle 16"
                                           StrokeThickness="0"
                                           VerticalOptions="FillAndExpand"
                                           HorizontalOptions="FillAndExpand">
                                        <Image Source="{Binding ImageFileName, Converter={StaticResource ImageConverter}}"
                                               Aspect="AspectFill"
                                               VerticalOptions="FillAndExpand"
                                               HorizontalOptions="FillAndExpand" />
                                    </Border>
                                    
                                    <!-- Gradient Overlay for Text Contrast -->
                                    <Border StrokeShape="RoundRectangle 16"
                                           StrokeThickness="0"
                                           VerticalOptions="FillAndExpand"
                                           HorizontalOptions="FillAndExpand">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                <GradientStop Color="Transparent" Offset="0.0" />
                                                <GradientStop Color="Transparent" Offset="0.4" />
                                                <GradientStop Color="#40000000" Offset="0.7" />
                                                <GradientStop Color="#80000000" Offset="1.0" />
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>
                                    
                                    <!-- Category Name with Enhanced Typography -->
                                    <Grid VerticalOptions="End" Margin="0,0,0,16">
                                        <Label Text="{Binding Name, Converter={StaticResource LanguageConverter}}" 
                                               FontSize="22" 
                                               FontAttributes="Bold" 
                                               TextColor="White"
                                               HorizontalOptions="Center"
                                               VerticalOptions="End"
                                               HorizontalTextAlignment="Center"
                                               VerticalTextAlignment="Center"
                                               LineBreakMode="WordWrap"
                                               MaxLines="2"
                                               Margin="16,8">
                                            <!-- Text Shadow for Better Readability -->
                                            <Label.Shadow>
                                                <Shadow Brush="Black"
                                                        Offset="1,1"
                                                        Radius="4"
                                                        Opacity="0.8" />
                                            </Label.Shadow>
                                        </Label>
                                    </Grid>
                                    
                                    <!-- Subtle Hover Effect Border -->
                                    <Border StrokeShape="RoundRectangle 16"
                                           Stroke="{AppThemeBinding Light=#20FFFFFF, Dark=#30FFFFFF}"
                                           StrokeThickness="1"
                                           VerticalOptions="FillAndExpand"
                                           HorizontalOptions="FillAndExpand"
                                           BackgroundColor="Transparent" />
                                </Grid>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand">
                        <Label Text="{Binding Source={x:Static strings:AppResources.NoCategoriesFound}, 
                                      Converter={StaticResource StaticResourceConverter}}" 
                               FontSize="18" 
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}"
                               HorizontalOptions="Center" />
                        <Label Text="{Binding Source={x:Static strings:AppResources.TryRefreshing}, 
                                      Converter={StaticResource StaticResourceConverter}}" 
                               FontSize="14" 
                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                               HorizontalOptions="Center" />
                    </StackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <!-- AdMob Banner Ad -->
        <admob:MTAdView Grid.Row="1" 
                        AdsId="ca-app-pub-2462813848027079/5189470585"
                        HeightRequest="50"
                        VerticalOptions="End"
                        HorizontalOptions="Fill" />

    </Grid>
</ContentPage>
